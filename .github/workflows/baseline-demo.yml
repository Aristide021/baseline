name: üéØ Baseline Demo

on:
  push:
    branches: [ demo ]
  pull_request:
    branches: [ demo ]
    paths:
      - 'src/**'
      - '*.html'
      - '*.css'
      - '*.js'

jobs:
  baseline-demo:
    runs-on: ubuntu-latest
    name: Official Baseline Queries Demo
    
    steps:
      - name: Checkout Demo Branch
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install Dependencies
        run: npm install
        
      - name: üÜï Run Baseline Check with STRICT Enforcement
        run: node src/index.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          INPUT_GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          INPUT_COMMENT_ON_PR: 'true'
          INPUT_OUTPUT_FORMAT: 'json'
          INPUT_SARIF_OUTPUT: 'baseline-results.sarif'
          INPUT_BASELINE_THRESHOLD: 'widely'
          INPUT_MAX_VIOLATIONS: '0'
          INPUT_ENFORCEMENT_MODE: 'error'
        continue-on-error: true
          
      - name: üìä Upload SARIF to GitHub Security
        uses: github/codeql-action/upload-sarif@v3
        if: always() && hashFiles('baseline-results.sarif') != ''
        with:
          sarif_file: 'baseline-results.sarif'
          category: 'baseline-compatibility-demo'
          
      - name: üìÅ Upload Demo Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: baseline-demo-report
          path: |
            baseline-report.json
            baseline-report.md
            baseline-results.sarif